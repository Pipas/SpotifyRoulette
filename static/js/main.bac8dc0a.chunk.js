(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,function(e,t,n){},,,,function(e,t,n){e.exports=n.p+"static/media/search.97161617.svg"},function(e,t,n){e.exports=n.p+"static/media/roulette.dc8d006c.svg"},function(e,t,n){e.exports=n.p+"static/media/spin.8f3bc11a.svg"},,function(e,t,n){e.exports=n.p+"static/media/warning.34c3adc3.svg"},,,,function(e,t,n){e.exports=n(32)},,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var c,a=n(0),r=n.n(a),s=n(9),i=n.n(s),o=(n(25),n(1)),u=n(5),l=n.n(u),f=n(10),m=n(18),d=n(2),h=n(4),b=n(11),v=n.n(b),p=function(){function e(){Object(d.a)(this,e),this.client=void 0,this.auth=!1,this.deviceId="",this.client=new v.a}return Object(h.a)(e,[{key:"authenticateUser",value:function(){var e=window.location.hash.substring(1).split("&")[0].split("=")[1];window.location.hash="";e?(this.client.setAccessToken(e),this.auth=!0):window.location.href="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("41e10dc3f3594667b190b3681fdee8ca","&redirect_uri=").concat("https://spotifyroulette.paulocorreia.me","&scope=").concat(["user-top-read","user-modify-playback-state","user-read-playback-state"].join("%20"),"&response_type=token&show_dialog=true")}},{key:"searchTrack",value:function(e){return this.client.searchTracks(e)}},{key:"play",value:function(e){""!==this.deviceId&&this.client.play(Object(m.a)({device_id:this.deviceId},e)).catch()}},{key:"hasPlayerOpen",value:function(){var e=Object(f.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.getMyDevices();case 2:if(0!==(t=e.sent).devices.length){e.next=7;break}return e.abrupt("return",!1);case 7:if(null===t.devices[0].id){e.next=12;break}return this.deviceId=t.devices[0].id,e.abrupt("return",!0);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isAuthenticated",value:function(){return this.auth}}]),e}(),O=(n(27),n(28),n(12)),E=n.n(O),y=(n(29),function(e){return r.a.createElement("div",{className:"result",onClick:e.onClick},r.a.createElement("img",{className:"cover",src:e.src,alt:"".concat(e.title," Album Cover")}),r.a.createElement("div",{className:"info"},r.a.createElement("h2",{className:"title"},e.title),r.a.createElement("p",{className:"artist"},e.author)))}),k=function(e){var t=Object(a.useRef)(null),n=Object(a.useState)(""),c=Object(o.a)(n,2),s=c[0],i=c[1],u=Object(a.useState)(""),l=Object(o.a)(u,2),f=l[0],m=l[1],d=Object(a.useCallback)(function(e){e&&0===f.length?i("focused"):e||f.length>0?i("focused"):i("")},[f.length]),h=Object(a.useCallback)(function(){null!==f&&""!==f&&e.onSearch(f)},[f,e]);Object(a.useEffect)(function(){var e=t.current,n=function(){return d(!0)},c=function(){return d(!1)},a=function(e){"Enter"===e.key&&h()};return null!==e&&(e.addEventListener("focus",n),e.addEventListener("focusout",c),e.addEventListener("keypress",a)),function(){null!==e&&(e.removeEventListener("focus",n),e.removeEventListener("focusout",c),e.removeEventListener("keypress",a))}},[h,d]),Object(a.useEffect)(function(){e.locked&&i("")},[e.locked]);var b=e.results.map(function(t,n){return r.a.createElement(y,Object.assign({key:n},t,{onClick:function(){return e.onResultClick(n)}}))});return r.a.createElement("div",{className:"input ".concat(s),style:{height:"".concat(88+64*e.results.length+(e.results.length?8:0),"px")}},r.a.createElement("div",{className:"searchBar"},r.a.createElement("input",{type:"text",ref:t,value:f,onChange:function(e){m(e.target.value)},placeholder:"Search",disabled:e.locked}),r.a.createElement("button",{onClick:h},r.a.createElement("img",{src:E.a,alt:""}))),!!e.results.length&&r.a.createElement("div",{className:"results"},b))},j=n(3),g=(n(8),n(13)),S=n.n(g),w=function(e){return function(e){var t=Object(a.useRef)(new j.Howl({src:"/audio/load.mp3"}));Object(a.useEffect)(function(){e&&t.current.play()},[e])}(e.loading),function(e,t){var n=Object(a.useRef)(new j.Howl({src:5===t?"/audio/shot.mp3":"/audio/blank.mp3"}));Object(a.useEffect)(function(){e&&n.current.play()},[e])}(e.shot,e.position),r.a.createElement("div",{className:"container",style:{transform:"rotate(".concat(-60*e.position,"deg)")}},r.a.createElement("div",{className:"cover ".concat(e.load&&"load")},r.a.createElement("img",{className:e.shot?"shot":"",src:e.src,alt:""})))};!function(e){e.EMPTY="empty",e.HALF="half",e.FULL="full"}(c||(c={}));var N,L=function(e){var t=Object(a.useState)(-1),n=Object(o.a)(t,2),s=n[0],i=n[1],u=Object(a.useState)(0),l=Object(o.a)(u,2),f=l[0],m=l[1],d=Object(a.useState)(c.EMPTY),h=Object(o.a)(d,2),b=h[0],v=h[1],p=function(e){var t=Object(a.useState)(-1),n=Object(o.a)(t,2),c=n[0],r=n[1];Object(a.useEffect)(function(){setTimeout(function(){e?(c>=0&&c<4&&s(),5===c&&s()):c>=0&&c<6&&s()},1500)},[c,e]);var s=function(){return r(function(e){return e+1})};return[c,s,function(){return r(-1)}]}(e.chooseBullet),O=Object(o.a)(p,3),E=O[0],y=O[1],k=O[2];!function(e){var t=Object(a.useRef)(new j.Howl({src:"/audio/spin.mp3"}));Object(a.useEffect)(function(){e&&t.current.play()},[e])}(e.state===N.SPINING);var g=[e.blank,e.blank,e.blank,e.blank,e.blank,e.bullet].map(function(t,n){return r.a.createElement(w,{key:n,src:t,position:n,shot:n===s&&e.state===N.SHOT,load:n<=E,loading:n===E&&e.state===N.LOADING})}),L=function(t,n){y(),setTimeout(function(){t()},n),e.setState(N.LOADING)},I=function(){i(-1),m(0),k(),v(c.EMPTY)},C=function(e){document.documentElement.style.setProperty("--previous","".concat(e))};Object(a.useEffect)(function(){if(e.state===N.LOAD)e.chooseBullet?b===c.EMPTY?L(function(){v(c.HALF),m(5),e.setState(N.IDLE)},7500):b===c.HALF?L(function(){e.setState(N.READY),v(c.FULL),C(5)},500):I():(I(),L(function(){m(5),e.setState(N.READY),v(c.FULL),C(5)},8300));else if(e.state===N.SPIN&&b===c.FULL){var t=R();setTimeout(function(){m(t),e.setState(N.SHOT)},1700),e.setState(N.SPINING)}else e.state===N.SHOT&&(C(s),e.onShoot(5===s),e.setState(N.IDLE))});var R=function(){var e=Math.floor(6*Math.random());return document.documentElement.style.setProperty("--next","".concat(e)),i(e),e};return r.a.createElement("div",{className:"roulette ".concat(e.state," ").concat(b),style:{transform:"rotate(calc(60deg * ".concat(f,"))")}},g,r.a.createElement("img",{src:S.a,alt:""}))},I=(n(30),function(e){return r.a.createElement("button",{className:"actionButton ".concat(e.visible?"visible":"")},r.a.createElement("img",{src:e.src,alt:""}))}),C=n(14),R=n.n(C),A=n(17),D=n(15),T=n(19),P=function(e){function t(){return Object(d.a)(this,t),Object(A.a)(this,Object(D.a)(t).apply(this,arguments))}return Object(T.a)(t,e),Object(h.a)(t,[{key:"search",value:function(e){var t=this;this.spotify.searchTrack(e).then(function(e){t.setResults(e.tracks.items.slice(0,3))})}},{key:"formatResults",value:function(e){return e.map(function(e){return{title:e.name,author:e.artists[0].name,src:e.album.images[0].url}})}},{key:"getItemSrc",value:function(e){return void 0===e?"":e.album.images[0].url}},{key:"play",value:function(e){this.spotify.play({uris:[e.uri]})}}]),t}(function e(t,n){Object(d.a)(this,e),this.spotify=t,this.setResults=n}),x=(n(31),n(16)),H=n.n(x),M=function(e){return r.a.createElement("div",{className:"warningDialog ".concat(e.visible?"visible":"hidden")},r.a.createElement("img",{src:H.a,alt:"Warning"}),r.a.createElement("h2",null,"Spotify not found"),r.a.createElement("p",null,"Make sure you have spotify open and press retry. If you continue no song will play."),r.a.createElement("button",{className:"retry",onClick:e.onRetryClick},"Retry"),r.a.createElement("button",{className:"continue",onClick:e.onContinueClick},"continue"))};!function(e){e.IDLE="idle",e.LOAD="load",e.LOADING="loading",e.READY="ready",e.SPIN="spin",e.SPINING="spining",e.SHOT="shot"}(N||(N={}));var Y=function(){var e=Object(a.useRef)(new p),t=Object(a.useState)(N.IDLE),n=Object(o.a)(t,2),c=n[0],s=n[1],i=Object(a.useState)([]),u=Object(o.a)(i,2),l=u[0],f=u[1],m=Object(a.useState)(),d=Object(o.a)(m,2),h=d[0],b=d[1],v=Object(a.useState)(),O=Object(o.a)(v,2),E=O[0],y=O[1],j=Object(a.useRef)(new P(e.current,f)),g=function(e,t,n){var c=Object(a.useState)(),r=Object(o.a)(c,2),s=r[0],i=r[1],u=Object(a.useCallback)(function(){return e.hasPlayerOpen().then(function(e){i(e)})},[e]);return Object(a.useEffect)(function(){t===N.READY&&(s?n(N.SPIN):u())},[s,u,t,n]),[s,u,i]}(e.current,c,s),S=Object(o.a)(g,3),w=S[0],C=S[1],A=S[2];Object(a.useEffect)(function(){e.current.isAuthenticated()||e.current.authenticateUser()},[]);return r.a.createElement("div",{className:"app"},r.a.createElement("div",{className:"controls"},r.a.createElement(k,{results:j.current.formatResults(l),onSearch:function(e){return j.current.search(e)},onResultClick:function(e){void 0===E?y(l[e]):b(l[e]),f([]),s(N.LOAD)},locked:c!==N.IDLE}),r.a.createElement(I,{src:R.a,visible:c===N.SHOT})),r.a.createElement(L,{blank:j.current.getItemSrc(E),bullet:j.current.getItemSrc(h),state:c,setState:s,chooseBullet:!0,onShoot:function(e){j.current.play(e?h:E)}}),r.a.createElement(M,{visible:!w&&void 0!==w,onRetryClick:C,onContinueClick:function(){s(N.SPIN),A(!0)}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(Y,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[20,1,2]]]);
//# sourceMappingURL=main.bac8dc0a.chunk.js.map