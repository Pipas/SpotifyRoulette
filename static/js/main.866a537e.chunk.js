(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,function(e,t,n){e.exports=n.p+"static/media/close.e85191c6.svg"},,,,function(e,t,n){},,,,function(e,t,n){e.exports=n.p+"static/media/search.97161617.svg"},function(e,t,n){e.exports=n.p+"static/media/roulette.dc8d006c.svg"},function(e,t,n){e.exports=n.p+"static/media/spin.8f3bc11a.svg"},function(e,t,n){e.exports=n.p+"static/media/settings.7c9f5af4.svg"},,function(e,t,n){e.exports=n.p+"static/media/warning.34c3adc3.svg"},,,,function(e,t,n){e.exports=n(36)},,,,,function(e,t,n){},,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var c,a=n(0),i=n.n(a),s=n(10),r=n.n(s),o=(n(27),n(1)),u=n(6),l=n.n(u),f=n(11),m=n(20),d=n(2),b=n(4),h=n(12),v=n.n(h),p=function(){function e(){Object(d.a)(this,e),this.client=void 0,this.auth=!1,this.deviceId="",this.client=new v.a}return Object(b.a)(e,[{key:"authenticateUser",value:function(){var e=window.location.hash.substring(1).split("&")[0].split("=")[1];window.location.hash="";e?(this.client.setAccessToken(e),this.auth=!0):window.location.href="".concat("https://accounts.spotify.com/authorize","?client_id=").concat("41e10dc3f3594667b190b3681fdee8ca","&redirect_uri=").concat("https://spotifyroulette.paulocorreia.me","&scope=").concat(["user-top-read","user-modify-playback-state","user-read-playback-state"].join("%20"),"&response_type=token&show_dialog=true")}},{key:"searchTrack",value:function(e){return this.client.searchTracks(e)}},{key:"play",value:function(e){""!==this.deviceId&&this.client.play(Object(m.a)({device_id:this.deviceId},e)).catch()}},{key:"hasPlayerOpen",value:function(){var e=Object(f.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.getMyDevices();case 2:if(0!==(t=e.sent).devices.length){e.next=7;break}return e.abrupt("return",!1);case 7:if(null===t.devices[0].id){e.next=12;break}return this.deviceId=t.devices[0].id,e.abrupt("return",!0);case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"isAuthenticated",value:function(){return this.auth}}]),e}(),E=(n(29),n(30),n(13)),O=n.n(E),k=(n(31),function(e){return i.a.createElement("div",{className:"result",onClick:e.onClick},i.a.createElement("img",{className:"cover",src:e.src,alt:"".concat(e.title," Album Cover")}),i.a.createElement("div",{className:"info"},i.a.createElement("h2",{className:"title"},e.title),i.a.createElement("p",{className:"artist"},e.author)))}),y=function(e){var t=Object(a.useRef)(null),n=Object(a.useState)(""),c=Object(o.a)(n,2),s=c[0],r=c[1],u=Object(a.useState)(""),l=Object(o.a)(u,2),f=l[0],m=l[1],d=Object(a.useCallback)(function(e){e&&0===f.length?r("focused"):e||f.length>0?r("focused"):r("")},[f.length]),b=Object(a.useCallback)(function(){null!==f&&""!==f&&e.onSearch(f)},[f,e]);Object(a.useEffect)(function(){var e=t.current,n=function(){return d(!0)},c=function(){return d(!1)},a=function(e){"Enter"===e.key&&b()};return null!==e&&(e.addEventListener("focus",n),e.addEventListener("focusout",c),e.addEventListener("keypress",a)),function(){null!==e&&(e.removeEventListener("focus",n),e.removeEventListener("focusout",c),e.removeEventListener("keypress",a))}},[b,d]),Object(a.useEffect)(function(){e.locked&&r("")},[e.locked]);var h=e.results.map(function(t,n){return i.a.createElement(k,Object.assign({key:n},t,{onClick:function(){return t=n,m(""),void e.onResultClick(t);var t}}))});return i.a.createElement("div",{className:"input ".concat(s),style:{height:"".concat(88+64*e.results.length+(e.results.length?8:0),"px")}},i.a.createElement("div",{className:"searchBar"},i.a.createElement("input",{type:"text",ref:t,value:f,onChange:function(e){m(e.target.value)},placeholder:"Search",disabled:e.locked}),i.a.createElement("button",{onClick:b},i.a.createElement("img",{src:O.a,alt:""}))),!!e.results.length&&i.a.createElement("div",{className:"results"},h))},g=n(3),j=(n(9),n(14)),S=n.n(j),N=function(e){return function(e){var t=Object(a.useRef)(new g.Howl({src:"/audio/load.mp3"}));Object(a.useEffect)(function(){e&&t.current.play()},[e])}(e.loading),function(e,t){var n=Object(a.useRef)(new g.Howl({src:5===t?"/audio/shot.mp3":"/audio/blank.mp3"}));Object(a.useEffect)(function(){e&&n.current.play()},[e])}(e.shot,e.position),i.a.createElement("div",{className:"container",style:{transform:"rotate(".concat(-60*e.position,"deg)")}},i.a.createElement("div",{className:"cover ".concat(e.load&&"load")},i.a.createElement("img",{className:e.shot?"shot":"",src:e.src,alt:""})))};!function(e){e.EMPTY="empty",e.HALF="half",e.FULL="full"}(c||(c={}));var w,C,I=function(e){var t=Object(a.useState)(-1),n=Object(o.a)(t,2),s=n[0],r=n[1],u=Object(a.useState)(0),l=Object(o.a)(u,2),f=l[0],m=l[1],d=Object(a.useState)(c.EMPTY),b=Object(o.a)(d,2),h=b[0],v=b[1],p=function(e){var t=Object(a.useState)(-1),n=Object(o.a)(t,2),c=n[0],i=n[1];Object(a.useEffect)(function(){setTimeout(function(){e?(c>=0&&c<4&&s(),5===c&&s()):c>=0&&c<6&&s()},1500)},[c,e]);var s=function(){return i(function(e){return e+1})};return[c,s,function(){return i(-1)}]}(e.chooseBullet),E=Object(o.a)(p,3),O=E[0],k=E[1],y=E[2];!function(e){var t=Object(a.useRef)(new g.Howl({src:"/audio/spin.mp3"}));Object(a.useEffect)(function(){e&&t.current.play()},[e])}(e.state===C.SPINING);var j=[e.blank,e.blank,e.blank,e.blank,e.blank,e.bullet].map(function(t,n){return i.a.createElement(N,{key:n,src:t,position:n,shot:n===s&&e.state===C.SHOT,load:n<=O,loading:n===O&&e.state===C.LOADING})}),w=function(t,n){k(),setTimeout(function(){t()},n),e.setState(C.LOADING)},I=function(){r(-1),m(0),y(),v(c.EMPTY)},L=function(e){document.documentElement.style.setProperty("--previous","".concat(e))};Object(a.useEffect)(function(){if(e.state===C.LOAD)e.chooseBullet?h===c.EMPTY?w(function(){v(c.HALF),m(5),e.setState(C.IDLE)},7500):h===c.HALF?w(function(){e.setState(C.READY),v(c.FULL),L(5)},500):I():(I(),w(function(){m(5),e.setState(C.READY),v(c.FULL),L(5)},8300));else if(e.state===C.SPIN&&h===c.FULL){var t=R();setTimeout(function(){m(t),e.setState(C.SHOT)},1700),e.setState(C.SPINING)}else e.state===C.SHOT?(L(s),e.onShoot(5===s)):e.state===C.RESET&&(I(),e.setState(C.IDLE))});var R=function(){var e=Math.floor(6*Math.random());return document.documentElement.style.setProperty("--next","".concat(e)),r(e),e};return i.a.createElement("div",{className:"roulette ".concat(e.state," ").concat(h),style:{transform:"rotate(calc(60deg * ".concat(f,"))")}},j,i.a.createElement("img",{src:S.a,alt:""}))},L=(n(32),n(15)),R=n.n(L),T=n(5),A=n.n(T),D=function(e){return i.a.createElement("div",{className:"actionButtonContainer ".concat(e.visible?"visible":"")},i.a.createElement("button",{className:"actionButton",onClick:e.onResetClick},i.a.createElement("img",{src:A.a,alt:""})),i.a.createElement("button",{className:"actionButton",onClick:e.onRerollClick},i.a.createElement("img",{src:R.a,alt:""})))},P=n(16),x=n.n(P),B=n(19),H=n(17),M=n(21),Y=function(e){function t(){return Object(d.a)(this,t),Object(B.a)(this,Object(H.a)(t).apply(this,arguments))}return Object(M.a)(t,e),Object(b.a)(t,[{key:"search",value:function(e){var t=this;this.spotify.searchTrack(e).then(function(e){t.setResults(e.tracks.items.slice(0,3))})}},{key:"formatResults",value:function(e){return e.map(function(e){return{title:e.name,author:e.artists[0].name,src:e.album.images[0].url}})}},{key:"getItemSrc",value:function(e){return void 0===e?"":e.album.images[0].url}},{key:"play",value:function(e){this.spotify.play({uris:[e.uri]})}}]),t}(function e(t,n){Object(d.a)(this,e),this.spotify=t,this.setResults=n}),F=(n(33),n(18)),G=n.n(F),U=function(e){return i.a.createElement("div",{className:"warningDialog ".concat(e.visible?"visible":"hidden")},i.a.createElement("img",{src:G.a,alt:"Warning"}),i.a.createElement("h2",null,"Spotify not found"),i.a.createElement("p",null,"Make sure you have spotify open and press retry. If you continue no song will play."),i.a.createElement("button",{className:"retry",onClick:e.onRetryClick},"Retry"),i.a.createElement("button",{className:"continue",onClick:e.onContinueClick},"continue"))},_=(n(34),n(35),function(e){var t=e.chips.map(function(t,n){return i.a.createElement("div",{key:n,className:"chip ".concat(n===e.selected?"selected":""),onClick:function(){return e.onSelect(n)}},t)});return i.a.createElement("div",{className:"chipContainer"},t)}),W=function(e){return i.a.createElement("div",{className:"settingsDialog ".concat(e.visible?"visible":"hidden")},i.a.createElement("h2",null,"Settings"),i.a.createElement("h3",null,"Bullet Type"),i.a.createElement(_,{selected:e.bulletType,chips:["Songs","Albuns","Artists"],onSelect:e.setBulletType}),i.a.createElement("img",{className:"close",src:A.a,onClick:e.toggleVisibility,alt:""}))};!function(e){e[e.Songs=0]="Songs",e[e.Albums=1]="Albums",e[e.Artists=2]="Artists"}(w||(w={})),function(e){e.RESET="reset",e.IDLE="idle",e.LOAD="load",e.LOADING="loading",e.READY="ready",e.SPIN="spin",e.SPINING="spining",e.SHOT="shot"}(C||(C={}));var J=function(){var e=Object(a.useRef)(new p),t=Object(a.useState)(C.IDLE),n=Object(o.a)(t,2),c=n[0],s=n[1],r=Object(a.useState)([]),u=Object(o.a)(r,2),l=u[0],f=u[1],m=Object(a.useState)(),d=Object(o.a)(m,2),b=d[0],h=d[1],v=Object(a.useState)(),E=Object(o.a)(v,2),O=E[0],k=E[1],g=Object(a.useRef)(new Y(e.current,f)),j=function(e,t,n){var c=Object(a.useState)(),i=Object(o.a)(c,2),s=i[0],r=i[1],u=Object(a.useCallback)(function(){return e.hasPlayerOpen().then(function(e){r(e)})},[e]);return Object(a.useEffect)(function(){t===C.READY&&(s?n(C.SPIN):u())},[s,u,t,n]),[s,u,r]}(e.current,c,s),S=Object(o.a)(j,3),N=S[0],L=S[1],R=S[2],T=function(){var e=Object(a.useState)(!1),t=Object(o.a)(e,2),n=t[0],c=t[1];return[n,function(){c(!n)}]}(),A=Object(o.a)(T,2),P=A[0],B=A[1],H=Object(a.useState)(w.Songs),M=Object(o.a)(H,2),F=M[0],G=M[1];Object(a.useEffect)(function(){e.current.isAuthenticated()||e.current.authenticateUser()},[]);return i.a.createElement("div",{className:"app"},i.a.createElement("div",{className:"controls"},i.a.createElement(y,{results:g.current.formatResults(l),onSearch:function(e){return g.current.search(e)},onResultClick:function(e){void 0===O?k(l[e]):h(l[e]),f([]),s(C.LOAD)},locked:c!==C.IDLE}),i.a.createElement(D,{visible:c===C.SHOT,onRerollClick:function(){return s(C.SPIN)},onResetClick:function(){h(void 0),k(void 0),s(C.RESET)}})),i.a.createElement(I,{blank:g.current.getItemSrc(O),bullet:g.current.getItemSrc(b),state:c,setState:s,chooseBullet:!0,onShoot:function(e){g.current.play(e?b:O)}}),i.a.createElement("img",{className:"settingsButton",src:x.a,onClick:B,alt:""}),i.a.createElement(U,{visible:!N&&void 0!==N,onRetryClick:L,onContinueClick:function(){s(C.SPIN),R(!0)}}),i.a.createElement(W,{visible:P,toggleVisibility:B,bulletType:F,setBulletType:G}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[22,1,2]]]);
//# sourceMappingURL=main.866a537e.chunk.js.map